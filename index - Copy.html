<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Quebra-Cabe√ßa da Tabuada</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; }
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 100px);
      grid-template-rows: repeat(3, 100px);
      gap: 5px;
      margin: 20px auto;
      width: 320px;
    }
    .cell {
      width: 100px; height: 100px;
      border: 2px solid #333;
      background: #fff;
      display: flex; align-items: center; justify-content: center;
      font-size: 20px; font-weight: bold;
      background-size: 300px 300px;
      background-repeat: no-repeat;
      transition: background 0.5s ease-in;
    }
    .piece {
      width: 100px; height: 100px;
      border: 2px solid #333;
      margin: 10px;
      display: inline-block;
      cursor: grab;
      position: relative;
    }
    .piece img {
      width: 100px; height: 100px;
      object-fit: none;
    }
    .label {
      position: absolute;
      bottom: 0;
      width: 100%;
      background: rgba(255,255,255,0.8);
      font-weight: bold;
      font-size: 14px;
    }
    .correct { border: 2px solid green; }
    #score { font-size: 18px; font-weight: bold; margin-top: 10px; }
    #restart { margin-top: 20px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>üß© Quebra-Cabe√ßa da Tabuada</h1>
  <p>Arraste a pe√ßa at√© o resultado correto!</p>

  <div id="score">Pontua√ß√£o: 0</div>
  <div class="grid" id="board"></div>
  <div id="pieces"></div>
  <button id="restart">üîÑ Reiniciar</button>

  <script>
    const images = Array.from({ length: 10 }, (_, i) => `https://picsum.photos/300?random=${i+1}`);
    let imgURL = "";
    let score = 0;
    let correctCount = 0;

    const board = document.getElementById("board");
    const piecesDiv = document.getElementById("pieces");
    const scoreDiv = document.getElementById("score");
    const restartBtn = document.getElementById("restart");

    const soundAcerto = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
    const soundErro = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
    const soundVitoria = new Audio("https://actions.google.com/sounds/v1/cartoon/slide_whistle_to_drum_hit.ogg");

    function startGame() {
      board.innerHTML = "";
      piecesDiv.innerHTML = "";
      score = 0;
      correctCount = 0;
      scoreDiv.textContent = "Pontua√ß√£o: " + score;
      imgURL = images[Math.floor(Math.random() * images.length)];

      // Gerar 9 opera√ß√µes √∫nicas da tabuada de 2 a 5
      const operations = [];
      while (operations.length < 9) {
        const a = Math.floor(Math.random() * 4) + 2; // 2 a 5
        const b = Math.floor(Math.random() * 10) + 1;
        const result = a * b;
        if (!operations.some(op => op.a === result)) {
          operations.push({ q: `${a} √ó ${b}`, a: result });
        }
      }

      // Criar c√©lulas do tabuleiro
      operations.forEach((op, index) => {
        const cell = document.createElement("div");
        cell.className = "cell";
        cell.textContent = op.a;
        cell.dataset.answer = op.a;
        cell.dataset.index = index;

        cell.addEventListener("dragover", e => e.preventDefault());
        cell.addEventListener("drop", e => {
          const draggedAnswer = e.dataTransfer.getData("text/plain");
          const pieceIndex = e.dataTransfer.getData("pieceIndex");
          if (draggedAnswer === cell.dataset.answer && !cell.classList.contains("correct")) {
            cell.classList.add("correct");
            cell.textContent = "";
            const row = Math.floor(pieceIndex / 3);
            const col = pieceIndex % 3;
            cell.style.backgroundImage = `url(${imgURL})`;
            cell.style.backgroundPosition = `-${col * 100}px -${row * 100}px`;
            correctCount++;
            score += 10;
            soundAcerto.play();
            scoreDiv.textContent = "Pontua√ß√£o: " + score;
            if (correctCount === 9) {
              soundVitoria.play();
              confettiCelebration();
              alert("üéâ Quebra-cabe√ßa completo!");
            }
          } else {
            score -= 5;
            soundErro.play();
            scoreDiv.textContent = "Pontua√ß√£o: " + score;
          }
        });

        board.appendChild(cell);
      });

      // Embaralhar opera√ß√µes
      const shuffled = [...operations].map((op, i) => ({ ...op, index: i }))
        .sort(() => Math.random() - 0.5);

      // Criar pe√ßas com imagem + conta
      shuffled.forEach(({ q, a, index }) => {
        const piece = document.createElement("div");
        piece.className = "piece";
        piece.draggable = true;
        piece.dataset.answer = a;
        piece.dataset.index = index;

        const img = document.createElement("img");
        img.src = imgURL;
        const row = Math.floor(index / 3);
        const col = index % 3;
        img.style.objectPosition = `-${col * 100}px -${row * 100}px`;

        const label = document.createElement("div");
        label.className = "label";
        label.textContent = q;

        piece.appendChild(img);
        piece.appendChild(label);

        piece.addEventListener("dragstart", e => {
          e.dataTransfer.setData("text/plain", a);
          e.dataTransfer.setData("pieceIndex", index);
        });

        piecesDiv.appendChild(piece);
      });
    }

    // Efeito de confete simples
    function confettiCelebration() {
      const duration = 2000;
      const end = Date.now() + duration;
      (function frame() {
        const colors = ["#bb0000", "#ffffff", "#00bb00", "#0000bb"];
        const confetti = document.createElement("div");
        confetti.style.position = "fixed";
        confetti.style.left = Math.random() * window.innerWidth + "px";
        confetti.style.top = "-10px";
        confetti.style.width = "10px";
        confetti.style.height = "10px";
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animation = "fall 2s linear";
        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 2000);
        if (Date.now() < end) requestAnimationFrame(frame);
      })();
    }

    restartBtn.addEventListener("click", startGame);

    startGame();
  </script>
</body>
</html>
